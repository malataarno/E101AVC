#include <stdio.h>
#include "E101.h"
#include <unistd.h>
#include <time.h>

//run robot needs fields for
//current quadrant
//camera position

//rubRobot needs to create new
//camera object
//network object
//wheel objects

//main method

class Camera{
        //fields here
        public:
        double runCamera(){

                int countc=0;
                //int main(){
                int i;
                int pix [320];
                int max=0;
                int min=0;
                double midValue;
                double errorRate=0;
                double finalError=0;
                int blackCount;


                                        while(countc <320)
                                                {pix [countc] = (int)get_pixel(120,countc,3);
                                                        countc++;
                                                        }


                                        for(i=0;i<320;i++){
                                                if(pix[i]>max){max=pix[i];}
                                                if(pix[i]<min){min=pix[i];}
                                                }
                                        midValue=(max-min)/2;
                                for(i=0;i<320;i++){
                                        if(pix[i]>midValue){
                                                pix[i]=0;
                                                }
                                        else{pix[i]=1;}
                                        }

                                        for(i=0;i<320;i++){
                                                errorRate=(i-160)*pix[i];
                                                finalError=finalError+errorRate;
                                                if(pix[i]==1){
                                                        blackCount++;
                                                }

                                                }
                                                finalError=finalError/blackCount;

                                                for(i=0;i<320;i+=32){
        printf(" %d",pix[i]);
        }printf("\n");
                                                return finalError;
                                                };

};


class GateOpen{
        //fields here
        private:
        char serverAddress[15] = { '1','3','0','.','1','9','5','.','6','.','1','9','6' };       //char server_addr[15] = { '1','2','7','.','0','0','1','.','0','0','1','.','0','0','1' }; TEST THE ADDRESS
        int port = 1024;                                                       //need to find what the port number is0
        char message[24] = { "Please" };                                       //find what the message should b1024

        public:
        //methods here
        int openGate(){
                //connect to the server
                connect_to_server(serverAddress,port);
                //send message to server
                send_to_server(message);
                //get message from server
                receive_from_server(message);
                //send server response back to server
                send_to_server(message);
                //gate opens, mission accomplished

                return 1;

        };

        };




class Wheels{
        private:
        Camera a;
        int leftW=50;
        int rightW=46;
        double kp=0.1;
        //fields here
        public:
        int speedDiff;
                double errorRate=0;
                double finalError;

                void setSpeed(){
        finalError=a.runCamera();
        //methods here
        speedDiff=(finalError*kp);
        printf("motor %d",speedDiff);
        printf(" %f",finalError);
set_motors(1,leftW+speedDiff);
set_motors(5,rightW+speedDiff);}
};


class RunRobot{
        //fields here
        public:
        //methods here

        };



int main(){
        //example code
                //make a new objec
                init(0);

                open_screen_stream();
                Wheels wheels;
                //Camera on;
        //GateOpen open;
                //call a method on the object
        //open.openGate();
        while(true){
                wheels.setSpeed();
                                hardware_exchange();take_picture(); update_screen();


        //on.runCamera();
        }
        close_screen_stream();
        return 0;
        };


